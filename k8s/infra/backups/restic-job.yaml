apiVersion: batch/v1
kind: CronJob
metadata:
  name: restic-backup
spec:
  schedule: "0 4 * * *"
  jobTemplate:
    spec:
      template:
        spec:
          restartPolicy: Never
          nodeName: drupelet-1
          hostname: drupelet-1
          containers:
            - image: gitea.cocointhe.cloud/coco/restic@sha256:30eb3c51b947c567b06772be6b6f95fea1974b70e26aed9af5337926c3a3f8c1
              name: restic-backup
              envFrom:
                - secretRef:
                    name: restic-config
              volumeMounts:
                - name: key-volume
                  mountPath: /tmp/key
                - mountPath: /nfs
                  name: nfs-root
                  readOnly: false
          volumes:
            - name: key-volume
              secret:
                secretName: sshkey
            - name: nfs-root
              hostPath:
                path: /nfs
                type: Directory
