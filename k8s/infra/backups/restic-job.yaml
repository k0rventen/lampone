apiVersion: batch/v1
kind: CronJob
metadata:
  name: restic-backup
spec:
  schedule: "0 4 * * *"
  concurrencyPolicy: Forbid
  jobTemplate:
    spec:
      backoffLimit: 2
      template:
        spec:
          restartPolicy: Never
          nodeName: drupelet-1
          hostname: drupelet-1
          containers:
            - image: gitea.cocointhe.cloud/coco/restic:2025.09.16-fc12269
              name: restic-backup
              envFrom:
                - secretRef:
                    name: restic-config
              volumeMounts:
                - name: key-volume
                  mountPath: /tmp/key
                - mountPath: /nfs
                  name: nfs-root
                  readOnly: false
          volumes:
            - name: key-volume
              secret:
                secretName: sshkey
            - name: nfs-root
              hostPath:
                path: /nfs
                type: Directory
