#docker run -d --restart=always -p 3001:3001 -v uptime-kuma:/app/data --name uptime-kuma louislam/uptime-kuma:1

apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: uptime-kuma
spec:
  install:
    createNamespace: true
  interval: 10m
  chart:
    spec:
      chart: ./k8s/appchart
      version: "x.x.x"
      sourceRef:
        kind: GitRepository
        name: flux-system
        namespace: flux-system
      interval: 10m
  targetNamespace: watchtower
  values:
    apps:
      - name: uptime-kuma
        image: louislam/uptime-kuma:1
        service: 3001
        volumeMounts:
          - name: uptime-kuma-data
            mountPath: /app/data
        volumes:
          - name: uptime-kuma-data
            persistentVolumeClaim:
              claimName: uptime-kuma-data
        ingress:
          domain: uptime.cocointhe.cloud
        pvc:
          - uptime-kuma-data
---
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: kuma-dashboard-redirect
spec:
  redirectRegex:
    regex: uptime\.cocointhe\.cloud\/?$
    replacement: https://uptime.cocointhe.cloud/status/uptime
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  annotations:
    traefik.ingress.kubernetes.io/router.middlewares: watchtower-kuma-dashboard-redirect@kubernetescrd
  name: uptime-kuma-tunnel
spec:
  ingressClassName: traefik-tunnel
  rules:
  - host: uptime.cocointhe.cloud
    http:
      paths:
      - backend:
          service:
            name: uptime-kuma
            port:
              number: 3001
        path: /
        pathType: Prefix
