apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: solar
  namespace: flux-system
spec:
  install:
    createNamespace: true
  interval: 24h
  chart:
    spec:
      chart: ./k8s/appchart
      version: "x.x.x"
      sourceRef:
        kind: GitRepository
        name: flux-system
        namespace: flux-system
      interval: 1h
  targetNamespace: cloud
  values:
    apps:
      - name: grafana
        image: grafana/grafana:11.6.1@sha256:52c3e20686b860c6dc1f623811565773cf51eefa378817a4896dfc863c3c82c8
        service: 3000
        ingress:
          public: true
          domain: solar.cocointhe.cloud

        volumeMounts:
          - name: grafana-config
            mountPath: /etc/grafana/grafana.ini
            subPath: grafana.ini
          - name: grafana-data
            mountPath: /var/lib/grafana
        volumes:
          - name: grafana-data
            persistentVolumeClaim:
              claimName: grafana-data
          - name: grafana-config
            configMap:
              name: grafana-config
        pvc:
          - grafana-data

    configmaps:
      grafana-config:
        grafana.ini: |
          [auth.anonymous]
          enabled = true
          org_name = Main Org.
          org_role = Viewer
          hide_version = true
